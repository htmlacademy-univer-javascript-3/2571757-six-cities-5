import{d as _,r as l,u as m,m as p,_ as w,j as e,n as v,f as b,A as y,o as E,s as A,e as N,O as R,p as O,i as M,q as S,k}from"./index-1a77823f.js";import{M as T}from"./index-41b19c9d.js";const F=s=>{switch(s){case 5:return"perfect";case 4:return"good";case 3:return"not bad";case 2:return"badly";case 1:return"terribly";default:return""}},h=50,C=300,D=[5,4,3,2,1],j={rating:void 0,comment:""},P=(s,r)=>{switch(r.type){case"UPDATE_FIELD":return{...s,[r.field]:r.value};case"RESET":return j;default:return s}},U=({offerId:s})=>{const{postOfferComment:r}=_(),[a,t]=l.useReducer(P,j),{postStatus:{loading:c,error:n}}=m(p);l.useEffect(()=>{n&&w.error(n)},[n]);const d=l.useCallback(i=>{const{name:o,value:u}=i.target;t({type:"UPDATE_FIELD",field:o,value:o==="rating"?Number(u):u})},[]),f=l.useCallback(i=>{i.preventDefault(),a.comment&&typeof a.rating=="number"&&(r({offerId:s,comment:a.comment,rating:a.rating}),t({type:"RESET"}))},[a,r,s]),g=!(typeof a.rating=="number"&&a.comment&&a.comment.length>=h&&a.comment.length<=C||c);return e.jsxs("form",{className:"reviews__form form",onSubmit:f,children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:D.map(i=>e.jsxs(l.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:i,id:`${i}-stars`,type:"radio",checked:a.rating===i,onChange:d}),e.jsx("label",{htmlFor:`${i}-stars`,className:"reviews__rating-label form__rating-label",title:F(i),children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},i))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"comment",name:"comment",value:a.comment,onChange:d,placeholder:"Tell how was your stay, what you like and what can be improved"}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:h}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:g,children:"Submit"})]})]})},z=s=>new Date(s).toLocaleString("ru",{year:"numeric",month:"long"}),L=({comment:s})=>e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:v(s.rating)}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",children:z(s.date)})]})]}),G=10,$=({comments:s})=>e.jsx("ul",{className:"reviews__list",children:s.slice(0,G).map(r=>e.jsx(L,{comment:r},r.id))}),H=({offerId:s})=>{const{fetchOfferComments:r}=_(),{comments:a}=m(p),{authorizationStatus:t}=m(b),c=a.length;return l.useEffect(()=>{r({offerId:s})},[s,r]),e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:c})]}),e.jsx($,{comments:a}),t===y.Authorized&&e.jsx(U,{offerId:s})]})};function x(s,r){switch(new Intl.PluralRules("en",{type:"ordinal"}).select(s)){case"one":return`${s} ${r[0]}`;default:return`${s} ${r[1]}`}}const W=s=>({id:s.id,previewImage:"",title:s.title,type:s.type,price:s.price,city:s.city,location:s.location,isFavorite:s.isFavorite,isPremium:s.isPremium,rating:s.rating}),X=3,B=4,V=({offerInfo:s})=>{const{nearestOffers:r,loading:a}=m(E),{fetchNearestOffers:t}=_(),c=m(A);if(l.useEffect(()=>{s!=null&&s.id&&t({offerId:s.id})},[s==null?void 0:s.id,t]),!r||a)return e.jsx(N,{size:"l"});const n=[...s?[W(s)]:[],...r];return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"offer__map",children:e.jsx(T,{offers:n.slice(0,B),activeCityName:c,width:"100%",selectedOffer:s})}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(R,{offers:r.slice(0,X),type:"nearest"})]})})]})},Y=s=>s.charAt(0).toUpperCase()+s.slice(1),q=6,J=({offerInfo:s,loading:r})=>!s||r?e.jsx(N,{size:"l"}):e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:s.images.slice(0,q).map(a=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:a,alt:"Offer Photo"})},a))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[s.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:s.title}),e.jsxs("button",{className:"offer__bookmark-button button",type:"button",children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:v(s.rating)}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:s.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:Y(s.type)}),e.jsx("li",{className:"offer__feature offer__feature--bedrooms",children:x(s.bedrooms,["Bedroom","Bedrooms"])}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",x(s.maxAdults,["adult","adults"])]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",s.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:s.goods.map(a=>e.jsx("li",{className:"offer__inside-item",children:a},a))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:"offer__avatar-wrapper offer__avatar-wrapper--pro user__avatar-wrapper",children:e.jsx("img",{className:"offer__avatar user__avatar",src:s.host.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:s.host.name}),e.jsx("span",{className:"offer__user-status",children:s.host.isPro?"Pro":"Default"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:s.description})})]}),e.jsx(H,{offerId:s.id})]})})]}),Z=()=>{const{id:s}=O(),r=M(),{fetchOfferInfo:a}=_(),{offerInfo:t,loading:c,error:n}=m(S);return l.useEffect(()=>{s&&a({offerId:s})},[a,s]),n&&r(k.NotFound),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsx(J,{offerInfo:t,loading:c}),e.jsx(V,{offerInfo:t})]})};export{Z as default};
