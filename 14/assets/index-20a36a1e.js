import{c as _,r as m,u as l,m as f,_ as g,j as e,n as w,f as u,A as b,o as S,s as O,g as y,O as k,k as E,e as F,l as R,p as x,q as M,t as T}from"./index-148b671a.js";import{M as C}from"./index-4a00b2f9.js";const D=s=>{switch(s){case 5:return"perfect";case 4:return"good";case 3:return"not bad";case 2:return"badly";case 1:return"terribly";default:return""}},N=50,P=300,z=[5,4,3,2,1],A={rating:void 0,comment:""},U=(s,a)=>{switch(a.type){case"UPDATE_FIELD":return{...s,[a.field]:a.value};case"RESET":return A;default:return s}},L=({offerId:s})=>{const{postOfferComment:a}=_(),[t,r]=m.useReducer(U,A),{postStatus:{loading:n,error:i}}=l(f);m.useEffect(()=>{i&&g.error(i)},[i]);const d=m.useCallback(c=>{const{name:v,value:p}=c.target;r({type:"UPDATE_FIELD",field:v,value:v==="rating"?Number(p):p})},[]),h=m.useCallback(c=>{c.preventDefault(),t.comment&&typeof t.rating=="number"&&(a({offerId:s,comment:t.comment,rating:t.rating}),r({type:"RESET"}))},[t,a,s]),o=!(typeof t.rating=="number"&&t.comment&&t.comment.length>=N&&t.comment.length<=P||n);return e.jsxs("form",{className:"reviews__form form",onSubmit:h,children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:z.map(c=>e.jsxs(m.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:c,id:`${c}-stars`,type:"radio",checked:t.rating===c,onChange:d}),e.jsx("label",{htmlFor:`${c}-stars`,className:"reviews__rating-label form__rating-label",title:D(c),children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},c))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"comment",name:"comment",value:t.comment,onChange:d,placeholder:"Tell how was your stay, what you like and what can be improved"}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:N}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:o,children:"Submit"})]})]})},$=s=>new Date(s).toLocaleString("ru",{year:"numeric",month:"long"}),G=({comment:s})=>e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:w(s.rating)}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",children:$(s.date)})]})]}),B=10,H=({comments:s})=>e.jsx("ul",{className:"reviews__list",children:s.slice(0,B).map(a=>e.jsx(G,{comment:a},a.id))}),W=({offerId:s})=>{const{fetchOfferComments:a}=_(),{comments:t}=l(f),{authorizationStatus:r}=l(u),n=t.length;return m.useEffect(()=>{a({offerId:s})},[s,a]),e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:n})]}),e.jsx(H,{comments:t}),r===b.Authorized&&e.jsx(L,{offerId:s})]})};function j(s,a){switch(new Intl.PluralRules("en",{type:"ordinal"}).select(s)){case"one":return`${s} ${a[0]}`;default:return`${s} ${a[1]}`}}const X=s=>({id:s.id,previewImage:"",title:s.title,type:s.type,price:s.price,city:s.city,location:s.location,isFavorite:s.isFavorite,isPremium:s.isPremium,rating:s.rating}),q=3,V=4,Y=({offerInfo:s})=>{const{nearestOffers:a,loading:t}=l(S),{fetchNearestOffers:r}=_(),n=l(O),{authorizationStatus:i}=l(u);if(m.useEffect(()=>{s!=null&&s.id&&r({offerId:s.id})},[s==null?void 0:s.id,r,i]),!a||t)return e.jsx(y,{size:"l"});const d=[...s?[X(s)]:[],...a];return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"offer__map",children:e.jsx(C,{offers:d.slice(0,V),activeCityName:n,width:"100%",selectedOffer:s})}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(k,{offers:a.slice(0,q),type:"nearest"})]})})]})},J=s=>s.charAt(0).toUpperCase()+s.slice(1),K=6,Q=({offerInfo:s,loading:a})=>{const t=E(),{changeFavoriteStatus:r}=_(),{postStatus:{loading:n,error:i}}=l(F),{authorizationStatus:d}=l(u);if(m.useEffect(()=>{i&&g.error(i)},[i]),!s||a)return e.jsx(y,{size:"l"});const h=()=>{if(d===b.Unauthorized){t(R.Login);return}const o=s.isFavorite?x.Remove:x.Add;r({offerId:s.id,status:o})};return e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:s.images.slice(0,K).map(o=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:o,alt:"Offer Photo"})},o))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[s.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:s.title}),e.jsxs("button",{className:`offer__bookmark-button button ${s.isFavorite&&"offer__bookmark-button--active"}`,type:"button",disabled:n,onClick:h,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:w(s.rating)}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:s.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:J(s.type)}),e.jsx("li",{className:"offer__feature offer__feature--bedrooms",children:j(s.bedrooms,["Bedroom","Bedrooms"])}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",j(s.maxAdults,["adult","adults"])]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",s.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:s.goods.map(o=>e.jsx("li",{className:"offer__inside-item",children:o},o))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:"offer__avatar-wrapper offer__avatar-wrapper--pro user__avatar-wrapper",children:e.jsx("img",{className:"offer__avatar user__avatar",src:s.host.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:s.host.name}),e.jsx("span",{className:"offer__user-status",children:s.host.isPro?"Pro":"Default"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:s.description})})]}),e.jsx(W,{offerId:s.id})]})})]})},ee=()=>{const{id:s}=M(),a=E(),{fetchOfferInfo:t}=_(),{offerInfo:r,loading:n,error:i}=l(T),{authorizationStatus:d}=l(u);return m.useEffect(()=>{s&&t({offerId:s})},[t,s,d]),i&&a(R.NotFound),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsx(Q,{offerInfo:r,loading:n}),e.jsx(Y,{offerInfo:r})]})};export{ee as default};
